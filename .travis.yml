language: go

go:
  - 1.11.x

script:
  - env GO111MODULE=on go mod download
  - env GO111MODULE=on go test -race ./...

notifications:
  email:
    on_success: never
    on_failure: always

before_deploy:
  - env GO111MODULE=on GOOS=linux go build -o bin/phoval-linux cmd/main/main.go
  - env GO111MODULE=on GOOS=darwin go build -o bin/phoval-mac cmd/main/main.go
  - env GO111MODULE=on GOOS=windows go build -o bin/phoval.exe cmd/main/main.go

deploy:
  provider: releases
  skip_cleanup: true
  file:
    - bin/phoval-linux
    - bin/phoval-mac
    - bin/phoval.exe
  on:
    repo: monteiro/phoval
    tags: true
